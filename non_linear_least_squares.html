<!DOCTYPE html>
<html lang="en">

<head>
    <!-- following line is needed so that plotly can display negative numbers in plots correctly -->
    <meta charset="utf-8">
    <!-- Plotly.js -->
    <!-- the local version requires the use of Plotly.newPlot -->
    <script src="scripts/plotly-2.18.2.min.js"></script>
    <!-- <script src="https://cdn.plot.ly/plotly-2.18.2.min.js"></script> -->
    <!-- <link rel="stylesheet" href="http://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/default.min.css">
    <script src="http://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script> -->
    <!-- use prism JS instead, looks nicer, especially the tomorrow dark theme -->
    <link rel="stylesheet" type="text/css" href="vendors/css/ionicons.min.css">
    <link rel="stylesheet" type="text/css" href="resources/css/style2.css">
    <link rel="stylesheet" type="text/css" href="vendors/css/prism.css">
    <link rel="stylesheet" type="text/css" href="resources/css/technical_page.css">
    <link rel="stylesheet" type="text/css" href="resources/css/queries.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script>
        MathJax = {
            tex: { inlineMath: [['$in', '$in'], ['\\(', '\\)']] }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>

<body>
    <nav>
        <div class="row">
            <!-- ul is an unordered list which should contain li list elements -->
            <ul class="main-nav js--main-nav">
                <li><a href="index.html">Home</a></li>
                <!-- TODO maybe thinking about changing Home to a home icon instead?-->
                <li><a herf="#">About us</a></li>
                <li><a herf="#">Education</a></li>
                <li><a herf="#">Resources</a></li>
            </ul>
            <a class="mobile-nav-icon js--nav-icon"><i class="ion-navicon-round"></i></a>
        </div>
    </nav>

    <div class="main-container">

        <h1 class="knowledge_h1">Non-linear least squeares inversion</h1>

        <h2 class="knowledge_h2">An example of why non-linear inversion is needed</h2>

        <p class="knowledge_p">
            We have seen in the previous sections how to perform linear inversion and even how to linearize a problem to
            solve it in the framework that we set up for the linear case. But in some cases we won't be able to solve
            our problem in a linear manner. We'll highlight this by introducing a real world problem that can't be
            linearized.
        </p>
        <p class="knowledge_p">
            The problem we will look at involves infra-red spectrometry data from massive young stellar objects (MYSOs).
            These objects are young stars that are still forming and gaining mass from accretion disks that deposit
            material on the star. As part of this process, jets of material are expelled at the poles of the MYSOs. By
            looking at absorption spectra from these MYSOs of certain transition of hydrogen with kmnown frequencies
            then we can approximate how much mass is being ejected from these poles and gain a slight understanding of
            whether the pole is oreinatated towards or away from us. The width and depth of the absorption spectra give
            an understanding of the mass loss rate as a larger cone will have a wider range of incendence anlges with
            the Earth and hence a wider spectrum (as some is blue shifted and some is red-shifted due to the velocity of
            material relative to the Earth) and a depper absorption line is a indicative of a higher density of
            material. So what do these spectra look like?
        </p>

        <img src="resources/myImgs/non_linear_inv_G236p7_initial.png"
            alt="Infra-red spectrometry data for a massive young stellar object (MYSO)" class="knowledge_img">

        <p class="knowledge_p">
            Given this it makes sense to try to fit Gaussian curves to the absoprtion spectra to give an estimate of the
            width (the standard deviation of the Gaussian) and the depth (the amplitude of the Gaussian). The centre
            point of the Gaussian can also tell us whether the absorption line as a wholeis red- or blue-shifted to give
            us some information about the speed of the MYSO relative to the Earth. So what would be the form of the
            Gaussian we want to fit? First note that the absorption spectra could be modelled not by Gaussians but by
            "negative" Gaussians with a baseline at 1 (i.e. just add 1 to the distribution). It is also apparent that
            the absorption spectra could have multiple different components which can be attributed to distinct ejection
            events or periods, but we'll only focus on fitting a single Gaussian here. The form of the model
            representing the absorption spectra (or at least one Gaussian component of it) is:
        </p>

        <p class="knowledge_eq">
            $$ \LARGE{y = 1 - A e^{\frac{-(x-\bar{x})^{2}}{2\sigma^{2}}} }$$
        </p>

        <p class="knowledge_p">
            where $in A $in is the amplitude of the Gaussian, $in \bar{x}$in is the location of the mean of the
            Gaussian, and $in\sigma$in is the standard deviation of the Guassian.<br><br>It is clear to see that is
            isn't really possible to linearly separate the three model variables from the measurement axis, $in x$in, in
            this equation. So if we can't solve this problem as a linear least squares problem then one solution is to
            solve it as a non-linear least squares problem.
        </p>

        <h2 class="knowledge_h2">Non-linear least squares derivation</h2>

        <p class="knowledge_p">
            In linear least squares we have our problem in the form $in d = Gm $in because we can linearly separate the
            model variables from the physics encapsulated in the data kernel, $in G$in. However, in the case presented
            above we can't linearly separate the model variables so our problem can only be formulated as:
        </p>

        <p class="knowledge_eq">
            d=G(m)
        </p>

        <p class="knowledge_p">
            Here the data kernel is a functino fo the model variables as we cannot separate the two. In non-linear least
            squares we don't attempt to directly solve this equation for the modle variables as was done before in the
            linear case. Instead we start with a guess of the model parameters and attempt to update these model
            variables using the misfit between the expected values using these model variables and the recorded values.
            How to define this update and traverse this misfit space is an entire subject in itself, optimization, that
            we will cover separately. Here we will derive and implement a basic optimization called gradient descent.
        </p>

        <!-- TODO - still need to complete this derivation section -->
        <p class="knowledge_p">PAGE UNDER CONSTRUCTION!</p>

        <p class="knowledge_eq">
            $$m_{k+1} = m_{k} - (J_{k}^{T} J_{k})^{-1} J_{k}^{T} r_{k} $$
        </p>

        <p class="knowledge_p">where</p>

        <p class="knowledge_eq">
            $$ J = \frac{\partial g}{\partial m}\big\rvert_{m_{0}} $$
        </p>

        <h2 class="knowledge_h2">Solving our Gaussian fitting problem with non-linear least squares inversion</h2>

        <p class="knowledge_p">
            Now we have a framework for solving problems in non-linear least squares inversion we'll use it to solve our
            original problem of fitting Gaussian curves to infrared spectrometry data. The function we want to fit is
        </p>

        <p class="knowledge_eq">
            $$ \LARGE{y = 1 - A e^{\frac{-(x-\bar{x})^{2}}{2\sigma^{2}}} }$$
        </p>

        <p class="knowledge_p">
            We now have to form the Jacobian matrix, $in J$in, via taking the partial derivative of the equation for the
            target variable with respect to each model parameter.
        </p>

        <p class="knowledge_eq">
            $\LARGE{\frac{\partial y}{\partial A} = -e^{\frac{-(x-\bar{x})^{2}}{2\sigma^{2}}}} $
        </p>

        <p class="knowledge_eq">
            $\LARGE{\frac{\partial y}{\partial \bar{x}} =
            -A\frac{(x-\bar{x})}{\sigma^{2}}e^{\frac{-(x-\bar{x})^{2}}{2\sigma^{2}}}} $
        </p>

        <p class="knowledge_eq">
            $\LARGE{\frac{\partial y}{\partial \sigma} =
            -A\frac{(x-\bar{x})^{2}}{\sigma^{3}}e^{\frac{-(x-\bar{x})^{2}}{2\sigma^{2}}}} $
        </p>

        <!-- !TODO - plot is low res, consider making figure bigger when printing, consider putting printed model separate -->
        <img src="resources/myImgs/moores_law_lin_plot.png"
            alt="A plot of athlete's weight Vs height with a fitted second order polynomial" class="knowledge_img">

        <pre><code class="language-python">print(model)</code></pre>


        <a class="next-page" href="non_linear_least_squares.html">Non-linear least squares inversion</a>

    </div>

    <div class="license">
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License"
                style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a><br />This
        work is
        licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons
            Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
    </div>


</body>

<!-- use this to run the code syntax highlighting in highlight.js -->
<!-- <script>hljs.highlightAll();</script> -->
<!-- use prism JS instead, looks nicer, especially the tomorrow dark theme -->
<script src="scripts/prism.js"></script>

</html>